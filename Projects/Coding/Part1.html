<!DOCTYPE html>
<html lang="en">
<head>
    <title>Quant Finance</title>
    <link rel="stylesheet" href="../../te.css">
    <script src="../../marked.min.js"></script>
    <script src ='../../script.js'></script>
</head>
<body>
<div class='column'>
<h1 id="The-Quant-Testing-Framework-I-use-to-create-profitable-strategies">The Quant Testing Framework I use to create profitable strategies</h1><p>Here is my setup for creating profitable strategies in quant. The framework is quite large and still expanding, meaning that I will post each of its aspects individually, and explain how they all fit together.</p>
<p>The modules I have created are:</p>
<ul>
    <li><code>yggdrasil.py</code>: contains the class Yggdrasil, which is the root of all my code; it creates an
        instance of a strategy which acts on a set of stocks. Combines StockAnalyzer and
        StrategyHelper (see below).</li>
    <li><code>market_analy</code>: contains a detailed retrieval method which obtains either live data or
        previously stored personal data given a set of parameters including trading frequency
        and number of data points</li>
    <li><code>useful_methods</code>: this is a module of helper functions which helps display code and various
        results easier and helps in analysis</li>
    <li><code>strategy_analy</code>: contains the class StockAnalyzer which can run various types of analysis,
        given a set of stocks</li>
    <li><code>strategy_helper.py</code>: contains the class StrategyHelper which creates an instance of a
        working strategy depending on which strategy is picked; does not contain a stock list
        but merely the strategy logic</li>
    <li><code>test_live_helper.py</code>: runs the actual live trading bot based on the tested strategy logic of
        the other modules.</li>
</ul>
<p>Below, I post the root module and explain in detail.</p>
<ul>
    <li>Module: yggdrasil.py  #Contains the class Yggdrasil<ul>
        <li>class: Yggdrasil <li>#This is the root of all my strategies and analysis. Creates a general
            instance of a test.</li><ul>
                <li>Instance variables:<ul>
                    <li>stock_universe: StockUniverse object which contains the list of stocks that will be used in this test</li>
                    <li>cur_strat: StrategyHelper object which sets and executes the basic framework of the given strategy in this test</li>
                    <li>strat_list: List of available executable strategies; mostly for convenience.</li>
                    <li>analysis: Various aspects of the stock list and the method being used; mostly for convenience</li>
                    <li>title: Defines the various aspects of the strategy being used; mostly for convenience</li>
                </ul>
                </li>
                <li>Constructor<ul>
                    <li>__ init __ (self, freq, strategy_,custom,shift_= 0, num_points = 500, stock_list = None)</li>
                    <li>Creates an instance of a test which is made of a strategy and a list of stocks. Executes this test upon instantiation</li>
                    <li>Parameters:<ul>
                        <li>freq: the frequency of the strategy being used</li>
                        <li>strategy_: the type of strategy being used</li>
                        <li>custom: the type ofdata being used, if custom or live</li>
                        <li>shift: how much the data isbeing shifted in its extraction. Measured in days regardless of the units of freq. Default value of 0.</li>
                        <li>num_points: number of data points in the extracted data. Note that this does not always return the exact number passed,but has a minimal error range in most cases ( Â±10). Default value is 500.</li>
                        <li>stock_list: the list of stocks the strategy as defined by theprevious parameters will act on</li>
                    </ul>
                    </li>
                </ul>
                </li>
                <li>Instance methods:<ul>
                    <li>__ set_title(self): Private method called upon instantiation which sets the title of the strategy if needed<br/></li>
                </ul>
                </li>
            </ul>
        </li>
        <li>free code: Saves the results of an example test run in a JSON file.<br/><ul>
            <li>The set of parameters is defined first and then the strategy is tested upon a list of variousstocks. In the given example, the set of parameters is the shift of the data and the parameters of the strategy being used, which is Mean Reversion in this case defined by two metrics.<ul>
                <li>These are the size of the rolling data used to compute metrics like the mean, and the cutoff z-score used to enter/exit the strategy. Everything else is held constant.</li>
            </ul>
            </li>
            <li>Note that in this example, I'm currently in the process of creating viable classes for stock classification, meaning that each allocation of stocks being tested asthe last parameter is merely just each individual stock only. The classification inthe example given is simply that the number of completed trades is above 30 in the given data set and the profit is positive.</li>
        </ul>
        </li>
    </ul>
    </li>
</ul>
<span class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span><code><code>

<span class="kn">import</span><span class="w"> </span><span class="nn">useful_methods</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">market_analy</span><span class="w"> </span><span class="kn">import</span> <span class="n">full_stocks</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">strategy_analy</span><span class="w"> </span><span class="kn">import</span> <span class="n">StockAnalyzer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">strategy_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">StrategyHelper</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Yggdrasil</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">strategy_</span><span class="p">,</span> <span class="n">custom</span><span class="p">,</span> <span class="n">shift_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">stock_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strat_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_strat</span> <span class="o">=</span> <span class="n">StrategyHelper</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">strategy_</span><span class="p">,</span> <span class="n">custom</span><span class="o">=</span><span class="n">custom</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="n">shift_</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="n">num_points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stock_universe</span> <span class="o">=</span> <span class="n">StockAnalyzer</span><span class="p">(</span><span class="n">stock_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_strat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_strat</span><span class="o">.</span><span class="n">run_method</span><span class="p">(</span><span class="n">stock_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_title</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__set_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'freq: '</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_strat</span><span class="o">.</span><span class="n">freq</span> <span class="o">+</span> <span class="s1">'_ '</span> <span class="o">+</span> <span class="s1">'num of data points: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_strat</span><span class="o">.</span><span class="n">num_points</span><span class="p">)</span> <span class="o">+</span>
                 <span class="s1">'_ custom: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_strat</span><span class="o">.</span><span class="n">custom</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'_ shift: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_strat</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span>
                 <span class="o">+</span> <span class="s1">'_ start date: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_strat</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'_ end date: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_strat</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
                 <span class="o">+</span> <span class="s1">'_ strategy:'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_strat</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span> <span class="o">+</span> <span class="s1">''</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">title</span>

<span class="c1"><span style="color:purple;"> #Generates the various parameters which can be tested in a clean manner.</span> </span>
<span class="n">para_test</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">roll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cutoff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="n">full_stocks</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">]:</span>
                <span class="n">para_test</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">stock</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">cutoff</span> <span class="o">/</span> <span class="mi">10</span><span class="p">])</span>

<span class="c1" style="color:purple;">#Runs the tests for various combinations of the parameters. Only two full stock iterations are ran for brevity. </span>
<span class="n">stock_pass_test</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stock_pass_condition</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">para_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span> <span class="o">*</span><span class="mi">2</span><span class="p">]:</span>
    <span class="n">strategy</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Mean Rev'</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">ygg</span> <span class="o">=</span> <span class="n">Yggdrasil</span><span class="p">(</span><span class="s1">'5m'</span><span class="p">,</span> <span class="n">strategy</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">shift_</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_points</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">stock_list</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="c1"style="color:purple;">#Condition for stock classification is given here to filter the backtests </span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">ygg</span><span class="o">.</span><span class="n">cur_strat</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'Profit'</span><span class="p">,</span> <span class="s1">'Number of Completed Trades'</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">stock_pass_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ygg</span><span class="o">.</span><span class="n">cur_strat</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span>

<span class="c1"style="color:purple;">#Data from all the tests is stored in a JSON file for easy viewing and extraction </span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'example_data.json'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdf</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">stock_pass_test</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<h2 >Data</h2><p>Link to the JSON file is given -> <button><a href="https://github.com/sponge-mi-boi/Quant-data/blob/main/example_data.json">data</a></button></p>
</div>
</body>
